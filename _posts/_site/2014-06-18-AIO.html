<p>java AIO实例，监听一个端口，输出telnet之后的输入的消息</p>
<div class='highlight'><pre><code class='java'><span class='kn'>import</span> <span class='nn'>java.io.IOException</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.net.InetSocketAddress</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.nio.channels.AsynchronousChannelGroup</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.nio.channels.AsynchronousServerSocketChannel</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.nio.channels.AsynchronousSocketChannel</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.nio.channels.CompletionHandler</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.util.concurrent.ExecutionException</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.util.concurrent.ExecutorService</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.util.concurrent.Executors</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>java.util.concurrent.Future</span><span class='o'>;</span>

<span class='kn'>import</span> <span class='nn'>com.sun.corba.se.impl.ior.ByteBuffer</span><span class='o'>;</span>

<span class='cm'>/**</span>
<span class='cm'> * &lt;p&gt;</span>
<span class='cm'> * Description:</span>
<span class='cm'> * &lt;/p&gt;</span>
<span class='cm'> * </span>
<span class='cm'> * @author Tony Wei</span>
<span class='cm'> * @version 1.0</span>
<span class='cm'> * @Date Jun 17, 2014</span>
<span class='cm'> */</span>
<span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>EchoServer</span> <span class='o'>{</span>

    <span class='kd'>private</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>port</span><span class='o'>;</span>

    <span class='kd'>public</span> <span class='nf'>EchoServer</span><span class='o'>(</span><span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>port</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>this</span><span class='o'>.</span><span class='na'>port</span> <span class='o'>=</span> <span class='n'>port</span><span class='o'>;</span>
        <span class='n'>listen</span><span class='o'>();</span>
    <span class='o'>}</span>

    <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>listen</span><span class='o'>()</span> <span class='o'>{</span>
        <span class='n'>ExecutorService</span> <span class='n'>executorService</span> <span class='o'>=</span> <span class='n'>Executors</span><span class='o'>.</span><span class='na'>newCachedThreadPool</span><span class='o'>();</span>
        <span class='k'>try</span> <span class='o'>{</span>
            <span class='n'>AsynchronousChannelGroup</span> <span class='n'>channelGroup</span> <span class='o'>=</span> <span class='n'>AsynchronousChannelGroup</span><span class='o'>.</span><span class='na'>withThreadPool</span><span class='o'>(</span><span class='n'>executorService</span><span class='o'>);</span>
            <span class='kd'>final</span> <span class='n'>AsynchronousServerSocketChannel</span> <span class='n'>server</span> <span class='o'>=</span> <span class='n'>AsynchronousServerSocketChannel</span><span class='o'>.</span><span class='na'>open</span><span class='o'>(</span><span class='n'>channelGroup</span><span class='o'>);</span>
            <span class='n'>System</span><span class='o'>.</span><span class='na'>out</span><span class='o'>.</span><span class='na'>println</span><span class='o'>(</span><span class='s'>&quot;start to listen port===&gt;&quot;</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>port</span><span class='o'>);</span>
            <span class='n'>server</span><span class='o'>.</span><span class='na'>bind</span><span class='o'>(</span><span class='k'>new</span> <span class='n'>InetSocketAddress</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>port</span><span class='o'>));</span>
            <span class='n'>server</span><span class='o'>.</span><span class='na'>accept</span><span class='o'>(</span><span class='kc'>null</span><span class='o'>,</span> <span class='k'>new</span> <span class='n'>CompletionHandler</span><span class='o'>&lt;</span><span class='n'>AsynchronousSocketChannel</span><span class='o'>,</span> <span class='n'>Object</span><span class='o'>&gt;()</span> <span class='o'>{</span>
                <span class='kd'>final</span> <span class='n'>java</span><span class='o'>.</span><span class='na'>nio</span><span class='o'>.</span><span class='na'>ByteBuffer</span> <span class='n'>bf</span> <span class='o'>=</span> <span class='n'>java</span><span class='o'>.</span><span class='na'>nio</span><span class='o'>.</span><span class='na'>ByteBuffer</span><span class='o'>.</span><span class='na'>allocate</span><span class='o'>(</span><span class='mi'>1024</span><span class='o'>);</span>

                <span class='nd'>@Override</span>
                <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>completed</span><span class='o'>(</span><span class='n'>AsynchronousSocketChannel</span> <span class='n'>result</span><span class='o'>,</span> <span class='n'>Object</span> <span class='n'>attachment</span><span class='o'>)</span> <span class='o'>{</span>
                    <span class='n'>bf</span><span class='o'>.</span><span class='na'>clear</span><span class='o'>();</span>
                    <span class='k'>try</span> <span class='o'>{</span>
                        <span class='n'>result</span><span class='o'>.</span><span class='na'>read</span><span class='o'>(</span><span class='n'>bf</span><span class='o'>).</span><span class='na'>get</span><span class='o'>();</span>
                        <span class='n'>bf</span><span class='o'>.</span><span class='na'>flip</span><span class='o'>();</span>
                        <span class='n'>result</span><span class='o'>.</span><span class='na'>write</span><span class='o'>(</span><span class='n'>bf</span><span class='o'>);</span>
                        <span class='n'>bf</span><span class='o'>.</span><span class='na'>flip</span><span class='o'>();</span>
                        <span class='n'>System</span><span class='o'>.</span><span class='na'>out</span><span class='o'>.</span><span class='na'>println</span><span class='o'>(</span><span class='s'>&quot;Echoed:&quot;</span> <span class='o'>+</span> <span class='k'>new</span> <span class='n'>String</span><span class='o'>(</span><span class='n'>bf</span><span class='o'>.</span><span class='na'>array</span><span class='o'>())</span> <span class='o'>+</span> <span class='s'>&quot; to &quot;</span> <span class='o'>+</span> <span class='n'>result</span><span class='o'>);</span>
                    <span class='o'>}</span> <span class='k'>catch</span> <span class='o'>(</span><span class='n'>Exception</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
                        <span class='n'>e</span><span class='o'>.</span><span class='na'>printStackTrace</span><span class='o'>();</span>
                    <span class='o'>}</span> <span class='k'>finally</span> <span class='o'>{</span>
                        <span class='k'>try</span> <span class='o'>{</span>
                            <span class='n'>result</span><span class='o'>.</span><span class='na'>close</span><span class='o'>();</span>
                        <span class='o'>}</span> <span class='k'>catch</span> <span class='o'>(</span><span class='n'>IOException</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
                            <span class='n'>e</span><span class='o'>.</span><span class='na'>printStackTrace</span><span class='o'>();</span>
                        <span class='o'>}</span>
                        <span class='n'>server</span><span class='o'>.</span><span class='na'>accept</span><span class='o'>(</span><span class='kc'>null</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>);</span>
                    <span class='o'>}</span>

                    <span class='n'>System</span><span class='o'>.</span><span class='na'>out</span><span class='o'>.</span><span class='na'>println</span><span class='o'>(</span><span class='s'>&quot;done..&quot;</span><span class='o'>);</span>

                <span class='o'>}</span>

                <span class='nd'>@Override</span>
                <span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>failed</span><span class='o'>(</span><span class='n'>Throwable</span> <span class='n'>exc</span><span class='o'>,</span> <span class='n'>Object</span> <span class='n'>attachment</span><span class='o'>)</span> <span class='o'>{</span>

                    <span class='n'>System</span><span class='o'>.</span><span class='na'>out</span><span class='o'>.</span><span class='na'>println</span><span class='o'>(</span><span class='s'>&quot;failed...&quot;</span> <span class='o'>+</span> <span class='n'>exc</span><span class='o'>.</span><span class='na'>getMessage</span><span class='o'>());</span>
                <span class='o'>}</span>
            <span class='o'>});</span>
            <span class='n'>Thread</span><span class='o'>.</span><span class='na'>sleep</span><span class='o'>(</span><span class='n'>Integer</span><span class='o'>.</span><span class='na'>MAX_VALUE</span><span class='o'>);</span>

        <span class='o'>}</span> <span class='k'>catch</span> <span class='o'>(</span><span class='n'>Exception</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
            <span class='n'>e</span><span class='o'>.</span><span class='na'>printStackTrace</span><span class='o'>();</span>
        <span class='o'>}</span>

    <span class='o'>}</span>

    <span class='kd'>public</span> <span class='kd'>static</span> <span class='kt'>void</span> <span class='nf'>main</span><span class='o'>(</span><span class='n'>String</span><span class='o'>[]</span> <span class='n'>args</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>EchoServer</span> <span class='n'>ser</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>EchoServer</span><span class='o'>(</span><span class='mi'>7000</span><span class='o'>);</span>
    <span class='o'>}</span>

<span class='o'>}</span>
</code></pre></div>